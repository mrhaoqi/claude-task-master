<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Master Web API</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .status-indicator {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            margin-top: 10px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .status-connected {
            background-color: #4CAF50;
            color: white;
        }

        .status-mock {
            background-color: #FF9800;
            color: white;
        }

        .main-content {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }

        .tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 1px solid #dee2e6;
        }

        .tab {
            flex: 1;
            padding: 15px 20px;
            text-align: center;
            cursor: pointer;
            border: none;
            background: none;
            font-size: 1rem;
            font-weight: 500;
            color: #6c757d;
            transition: all 0.3s ease;
        }

        .tab:hover {
            background: #e9ecef;
            color: #495057;
        }

        .tab.active {
            background: #007bff;
            color: white;
        }

        .tab-content {
            padding: 30px;
            min-height: 500px;
        }

        .tab-pane {
            display: none;
        }

        .tab-pane.active {
            display: block;
        }

        .config-section {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
        }

        .info-group {
            margin-bottom: 15px;
        }

        .info-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
        }

        .info-value {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 10px 12px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.85rem;
            color: #495057;
            word-break: break-all;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0,123,255,0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-primary {
            background: linear-gradient(135deg, #007bff, #0056b3);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,123,255,0.4);
        }

        .btn-success {
            background: linear-gradient(135deg, #28a745, #1e7e34);
            color: white;
        }

        .btn-success:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(40,167,69,0.4);
        }

        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #e0a800);
            color: #212529;
        }

        .btn-warning:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,193,7,0.4);
        }

        .btn-info {
            background: linear-gradient(135deg, #17a2b8, #138496);
            color: white;
        }

        .btn-info:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(23,162,184,0.4);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .response-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
            color: #007bff;
        }

        .loading.show {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #007bff;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .task-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .task-item:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .task-detail {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
            white-space: pre-wrap;
            max-height: 400px;
            overflow-y: auto;
        }

        .task-detail h4 {
            margin: 0 0 10px 0;
            color: #495057;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            font-size: 1rem;
        }

        .task-detail .loading {
            text-align: center;
            color: #6c757d;
            font-style: italic;
        }

        .task-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 10px;
        }

        .task-id {
            background: #007bff;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .task-status {
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-done {
            background: #d4edda;
            color: #155724;
        }

        .status-in-progress {
            background: #cce5ff;
            color: #004085;
        }

        .task-title {
            font-weight: 600;
            margin-bottom: 5px;
            color: #343a40;
        }

        .task-description {
            color: #6c757d;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .file-upload-area {
            border: 2px dashed #dee2e6;
            border-radius: 8px;
            padding: 40px;
            text-align: center;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload-area:hover {
            border-color: #007bff;
            background: #f8f9fa;
        }

        .file-upload-area.dragover {
            border-color: #007bff;
            background: #e3f2fd;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .alert-info {
            background: #cce5ff;
            color: #004085;
            border: 1px solid #b3d7ff;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .card {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .card-header {
            font-weight: 600;
            margin-bottom: 15px;
            color: #343a40;
            border-bottom: 1px solid #dee2e6;
            padding-bottom: 10px;
        }

        .form-check {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .form-check-input {
            margin-right: 8px;
        }

        .form-check-label {
            margin-bottom: 0;
            cursor: pointer;
        }

        .config-section {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .config-section h3 {
            margin-top: 0;
            color: #495057;
            border-bottom: 2px solid #e9ecef;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        /* çŠ¶æ€åˆ†ç»„æ ·å¼ */
        .status-group {
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border-radius: 8px;
            overflow: hidden;
        }

        .status-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 20px;
            font-weight: 600;
            border-radius: 8px 8px 0 0;
        }

        .status-tasks {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 0 0 8px 8px;
        }

        .task-count {
            background: rgba(255,255,255,0.2);
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
        }

        .toggle-icon {
            display: inline-block;
            margin-right: 8px;
            transition: transform 0.3s ease;
            font-size: 0.8rem;
        }

        .toggle-icon.collapsed {
            transform: rotate(-90deg);
        }

        .status-tasks.collapsed {
            display: none !important;
        }

        .status-header:hover {
            filter: brightness(1.1);
        }

        /* å¢å¼ºä»»åŠ¡é¡¹æ ·å¼ */
        .task-item {
            background: white;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
        }

        .task-item:hover {
            box-shadow: 0 4px 8px rgba(0,0,0,0.15);
            transform: translateY(-2px);
        }

        .task-item:last-child {
            margin-bottom: 0;
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .tabs {
                flex-direction: column;
            }

            .tab-content {
                padding: 20px;
            }

            .btn-group {
                flex-direction: column;
            }

            .btn {
                width: 100%;
            }
            
            .status-header {
                flex-direction: column;
                gap: 8px;
                text-align: center;
            }
            
            .task-count {
                align-self: center;
            }
            
            .btn-group {
                flex-wrap: wrap;
                gap: 8px;
            }
            
            .btn-group .btn {
                flex: 1;
                min-width: 100px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <!-- <h1>ğŸš€ Task Master Web API</h1>
            <p>å¼ºå¤§çš„ä»»åŠ¡ç®¡ç†å’ŒAIè¾…åŠ©å¼€å‘å¹³å°</p> -->
            <span id="statusIndicator" class="status-indicator status-mock">ğŸ”„ æ£€æŸ¥è¿æ¥ä¸­...</span>
        </div>

        <div class="main-content">
            <div class="tabs">
                <button class="tab active" data-tab="config">âš™ï¸ é…ç½®</button>
                <button class="tab" data-tab="tasks">ğŸ“‹ ä»»åŠ¡ç®¡ç†</button>
                <button class="tab" data-tab="projects">ğŸ—ï¸ é¡¹ç›®ç®¡ç†</button>
                <button class="tab" data-tab="research">ğŸ”¬ AIç ”ç©¶</button>
                <button class="tab" data-tab="docs">ğŸ“š APIæ–‡æ¡£</button>
            </div>

            <!-- é…ç½®æ ‡ç­¾é¡µ -->
            <div class="tab-content">
                <div class="tab-pane active" id="config">
                    <!-- ç³»ç»ŸçŠ¶æ€ -->
                    <div class="config-section">
                        <h3>ğŸ“Š ç³»ç»ŸçŠ¶æ€</h3>
                        <div class="grid">
                            <div class="card">
                                <div class="card-header">è¿æ¥çŠ¶æ€</div>
                                <div id="systemStatus">
                                    <p>ç‚¹å‡»"æµ‹è¯•è¿æ¥"æ¥æ£€æŸ¥ç³»ç»ŸçŠ¶æ€</p>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">APIç»Ÿè®¡</div>
                                <div id="apiStats">
                                    <button class="btn btn-info" onclick="loadApiStats()">ğŸ“ˆ è·å–ç»Ÿè®¡ä¿¡æ¯</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- é¡¹ç›®é…ç½® -->
                    <div class="config-section">
                        <h3>ğŸ—ï¸ é¡¹ç›®é…ç½®</h3>
                        <div class="grid">
                            <div class="card">
                                <div class="card-header">å½“å‰é¡¹ç›®ä¿¡æ¯</div>
                                <div id="projectInfo">
                                    <button class="btn btn-info" onclick="loadProjectInfo()">ğŸ“‹ åŠ è½½é¡¹ç›®ä¿¡æ¯</button>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">æ ‡ç­¾ç®¡ç†</div>
                                <div id="tagsInfo">
                                    <button class="btn btn-info" onclick="loadTagsInfo()">ğŸ·ï¸ åŠ è½½æ ‡ç­¾ä¿¡æ¯</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- AIæ¨¡å‹é…ç½® -->
                    <div class="config-section">
                        <h3>ğŸ¤– AIæ¨¡å‹é…ç½®</h3>
                        <div class="alert alert-info">
                            <strong>â„¹ï¸ æç¤ºï¼š</strong> AIæ¨¡å‹é…ç½®éœ€è¦è”ç³»ç®¡ç†å‘˜è¿›è¡Œä¿®æ”¹
                        </div>
                        <div class="grid">
                            <div class="card">
                                <div class="card-header">ä¸»è¦æ¨¡å‹ (Main)</div>
                                <div class="info-group">
                                    <label>å½“å‰æ¨¡å‹</label>
                                    <div class="info-value" id="currentMainModel">åŠ è½½ä¸­...</div>
                                </div>
                                <div class="info-group">
                                    <label>Base URL</label>
                                    <div class="info-value" id="currentMainBaseUrl">åŠ è½½ä¸­...</div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">ç ”ç©¶æ¨¡å‹ (Research)</div>
                                <div class="info-group">
                                    <label>å½“å‰æ¨¡å‹</label>
                                    <div class="info-value" id="currentResearchModel">åŠ è½½ä¸­...</div>
                                </div>
                                <div class="info-group">
                                    <label>Base URL</label>
                                    <div class="info-value" id="currentResearchBaseUrl">åŠ è½½ä¸­...</div>
                                </div>
                            </div>
                            
                            <div class="card">
                                <div class="card-header">åå¤‡æ¨¡å‹ (Fallback)</div>
                                <div class="info-group">
                                    <label>å½“å‰æ¨¡å‹</label>
                                    <div class="info-value" id="currentFallbackModel">åŠ è½½ä¸­...</div>
                                </div>
                                <div class="info-group">
                                    <label>Base URL</label>
                                    <div class="info-value" id="currentFallbackBaseUrl">åŠ è½½ä¸­...</div>
                                </div>
                            </div>
                        </div>
                        
                        <button class="btn btn-info" onclick="loadAiConfig()">ğŸ”„ åˆ·æ–°AIé…ç½®ä¿¡æ¯</button>
                    </div>

                    <!-- APIé…ç½® -->
                    <div class="config-section">
                        <h3>ğŸ”‘ APIé…ç½®</h3>
                        <div class="alert alert-info">
                            <strong>ğŸ”’ å®‰å…¨æç¤ºï¼š</strong> APIå¯†é’¥å°†åœ¨æœ¬åœ°ä¿å­˜24å°æ—¶ï¼Œæ— éœ€é‡å¤è¾“å…¥ã€‚24å°æ—¶åå°†è‡ªåŠ¨æ¸…é™¤ä»¥ç¡®ä¿å®‰å…¨ã€‚
                        </div>
                        <div class="form-group">
                            <label for="apiKey">APIå¯†é’¥</label>
                            <input type="password" id="apiKey" class="form-control" value="" placeholder="è¾“å…¥æ‚¨çš„APIå¯†é’¥">
                        </div>
                        <div class="form-group">
                            <label for="baseUrl">APIåŸºç¡€URL</label>
                            <input type="text" id="baseUrl" class="form-control" value="http://localhost:3000" placeholder="http://localhost:3000">
                        </div>
                        <button class="btn btn-primary" onclick="testConnection()">ğŸ” æµ‹è¯•è¿æ¥</button>
                    </div>


                </div>

                <!-- ä»»åŠ¡ç®¡ç†æ ‡ç­¾é¡µ -->
                <div class="tab-pane" id="tasks">
                    <div class="btn-group">
                        <button class="btn btn-primary" onclick="loadTasks()">ğŸ“‹ è·å–ä»»åŠ¡åˆ—è¡¨</button>
                        <button class="btn btn-success" onclick="getNextTask()">â­ï¸ ä¸‹ä¸€ä¸ªä»»åŠ¡</button>
                        <button class="btn btn-info" onclick="showCreateTaskForm()">â• åˆ›å»ºä»»åŠ¡</button>
                        <button class="btn btn-warning" onclick="toggleAllStatusGroups()" id="toggleAllBtn" style="display: none;">ğŸ“‚ å…¨éƒ¨æŠ˜å </button>
                    </div>

                    <div id="createTaskForm" style="display: none;" class="config-section">
                        <h4>åˆ›å»ºæ–°ä»»åŠ¡</h4>
                        <div class="form-group">
                            <label for="taskPrompt">ä»»åŠ¡æè¿°</label>
                            <textarea id="taskPrompt" class="form-control" rows="3" placeholder="æè¿°æ‚¨è¦åˆ›å»ºçš„ä»»åŠ¡..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="taskPriority">ä¼˜å…ˆçº§</label>
                            <select id="taskPriority" class="form-control">
                                <option value="medium">ä¸­ç­‰</option>
                                <option value="high">é«˜</option>
                                <option value="low">ä½</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="taskDependencies">ä¾èµ–ä»»åŠ¡ID (é€—å·åˆ†éš”)</label>
                            <input type="text" id="taskDependencies" class="form-control" placeholder="ä¾‹å¦‚: 1,2,3">
                        </div>
                        <div class="btn-group">
                            <button class="btn btn-success" onclick="createTask()">âœ… åˆ›å»ºä»»åŠ¡</button>
                            <button class="btn btn-warning" onclick="hideCreateTaskForm()">âŒ å–æ¶ˆ</button>
                        </div>
                    </div>

                    <div id="tasksContainer">
                        <p class="text-center">ç‚¹å‡»"è·å–ä»»åŠ¡åˆ—è¡¨"æ¥åŠ è½½ä»»åŠ¡</p>
                    </div>
                </div>

                <!-- é¡¹ç›®ç®¡ç†æ ‡ç­¾é¡µ -->
                <div class="tab-pane" id="projects">
                    <div class="grid">
                        <div class="card">
                            <div class="card-header">ğŸ—ï¸ é¡¹ç›®åˆå§‹åŒ–</div>
                            <div class="form-group">
                                <label for="projectName">é¡¹ç›®åç§°</label>
                                <input type="text" id="projectName" class="form-control" placeholder="æˆ‘çš„é¡¹ç›®">
                            </div>
                            <div class="form-group">
                                <label for="projectDescription">é¡¹ç›®æè¿°</label>
                                <textarea id="projectDescription" class="form-control" rows="3" placeholder="é¡¹ç›®æè¿°..."></textarea>
                            </div>
                            <div class="form-group">
                                <label for="projectVersion">ç‰ˆæœ¬</label>
                                <input type="text" id="projectVersion" class="form-control" value="1.0.0" placeholder="1.0.0">
                            </div>
                            <button class="btn btn-primary" onclick="initializeProject()">ğŸš€ åˆå§‹åŒ–é¡¹ç›®</button>
                        </div>

                        <div class="card">
                            <div class="card-header">ğŸ“„ PRDè§£æ</div>
                            <div class="form-group">
                                <label for="prdContent">PRDå†…å®¹</label>
                                <textarea id="prdContent" class="form-control" rows="6" placeholder="è¾“å…¥äº§å“éœ€æ±‚æ–‡æ¡£å†…å®¹...&#10;ä¾‹å¦‚ï¼šåˆ›å»ºä¸€ä¸ªç”¨æˆ·ç®¡ç†ç³»ç»Ÿï¼ŒåŒ…å«ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€ä¸ªäººèµ„æ–™ç®¡ç†ç­‰åŠŸèƒ½..."></textarea>
                            </div>
                            <div class="form-group">
                                <label for="numTasks">ç”Ÿæˆä»»åŠ¡æ•°é‡</label>
                                <input type="number" id="numTasks" class="form-control" value="5" min="1" max="20">
                            </div>
                            <button class="btn btn-success" onclick="parsePrd()">ğŸ”„ è§£æPRD</button>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header">ğŸ“ PRDæ–‡ä»¶ä¸Šä¼ </div>
                        <div class="file-upload-area" id="fileUploadArea" onclick="document.getElementById('prdFile').click()">
                            <div>
                                <h4>ğŸ“ ç‚¹å‡»æˆ–æ‹–æ‹½ä¸Šä¼ PRDæ–‡ä»¶</h4>
                                <p>æ”¯æŒ .txt, .md ç­‰æ–‡æœ¬æ–‡ä»¶ï¼Œæœ€å¤§10MB</p>
                            </div>
                            <input type="file" id="prdFile" style="display: none;" accept=".txt,.md,.text" onchange="handleFileSelect(event)">
                        </div>
                        <button class="btn btn-info" onclick="uploadPrdFile()" id="uploadBtn" disabled>ğŸ“¤ ä¸Šä¼ å¹¶è§£æ</button>
                    </div>
                </div>

                <!-- AIç ”ç©¶æ ‡ç­¾é¡µ -->
                <div class="tab-pane" id="research">
                    <div class="config-section">
                        <h3>ğŸ”¬ AIç ”ç©¶æŸ¥è¯¢</h3>
                        <div class="form-group">
                            <label for="researchQuery">ç ”ç©¶é—®é¢˜</label>
                            <textarea id="researchQuery" class="form-control" rows="3" placeholder="è¾“å…¥æ‚¨æƒ³ç ”ç©¶çš„é—®é¢˜...&#10;ä¾‹å¦‚ï¼šReact Hookçš„æœ€ä½³å®è·µæœ‰å“ªäº›ï¼Ÿ"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="detailLevel">è¯¦ç»†ç¨‹åº¦</label>
                            <select id="detailLevel" class="form-control">
                                <option value="medium">ä¸­ç­‰</option>
                                <option value="high">è¯¦ç»†</option>
                                <option value="low">ç®€è¦</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="customContext">è‡ªå®šä¹‰ä¸Šä¸‹æ–‡ (å¯é€‰)</label>
                            <textarea id="customContext" class="form-control" rows="2" placeholder="æä¾›é¢å¤–çš„ä¸Šä¸‹æ–‡ä¿¡æ¯..."></textarea>
                        </div>
                        <button class="btn btn-primary" onclick="performResearch()">ğŸ” å¼€å§‹ç ”ç©¶</button>
                    </div>

                    <div id="researchResults">
                        <p class="text-center">è¾“å…¥ç ”ç©¶é—®é¢˜å¹¶ç‚¹å‡»"å¼€å§‹ç ”ç©¶"æ¥è·å–AIåˆ†æç»“æœ</p>
                    </div>
                </div>

                <!-- APIæ–‡æ¡£æ ‡ç­¾é¡µ -->
                <div class="tab-pane" id="docs">
                    <div class="config-section">
                        <h3>ğŸ“š APIæ–‡æ¡£</h3>
                        <p>Task Master Web API æä¾›äº†å®Œæ•´çš„ä»»åŠ¡ç®¡ç†åŠŸèƒ½ã€‚</p>
                        
                        <h4>ğŸ”— å¿«é€Ÿé“¾æ¥</h4>
                        <div class="btn-group">
                            <a href="/docs" target="_blank" class="btn btn-primary">ğŸ“– Swaggeræ–‡æ¡£</a>
                            <a href="/debug/routes" target="_blank" class="btn btn-info">ğŸ” è°ƒè¯•ä¿¡æ¯</a>
                            <button class="btn btn-success" onclick="loadApiDocs()">ğŸ“‹ è·å–è·¯ç”±åˆ—è¡¨</button>
                        </div>
                    </div>

                    <div id="apiDocsContainer">
                        <p class="text-center">ç‚¹å‡»"è·å–è·¯ç”±åˆ—è¡¨"æ¥æŸ¥çœ‹å¯ç”¨çš„APIç«¯ç‚¹</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- åŠ è½½æŒ‡ç¤ºå™¨ -->
        <div class="loading" id="loadingIndicator">
            <div class="spinner"></div>
            <p>å¤„ç†ä¸­ï¼Œè¯·ç¨å€™...</p>
        </div>

        <!-- å“åº”åŒºåŸŸ -->
        <div class="response-area" id="responseArea" style="display: none;"></div>
    </div>

    <script>
        // å…¨å±€é…ç½®
        let config = {
            apiKey: 'test-api-key-123',
            baseUrl: 'http://localhost:3000'
        };

        let selectedFile = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            initializeTabs();
            loadConfig();
            loadAiConfig();
            testConnection();
            setupFileUpload();
        });

        // æ ‡ç­¾é¡µåŠŸèƒ½
        function initializeTabs() {
            const tabs = document.querySelectorAll('.tab');
            const panes = document.querySelectorAll('.tab-pane');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const targetTab = tab.dataset.tab;
                    
                    // ç§»é™¤æ‰€æœ‰æ´»åŠ¨çŠ¶æ€
                    tabs.forEach(t => t.classList.remove('active'));
                    panes.forEach(p => p.classList.remove('active'));
                    
                    // æ·»åŠ æ´»åŠ¨çŠ¶æ€
                    tab.classList.add('active');
                    document.getElementById(targetTab).classList.add('active');
                });
            });
        }

        // åŠ è½½é…ç½®
        function loadConfig() {
            // æ£€æŸ¥APIå¯†é’¥æ˜¯å¦åœ¨24å°æ—¶å†…ä¿å­˜è¿‡
            const savedApiKeyData = localStorage.getItem('taskmaster_api_key_data');
            const savedBaseUrl = localStorage.getItem('taskmaster_base_url');
            
            if (savedApiKeyData) {
                try {
                    const keyData = JSON.parse(savedApiKeyData);
                    const now = Date.now();
                    const twentyFourHours = 24 * 60 * 60 * 1000; // 24å°æ—¶çš„æ¯«ç§’æ•°
                    
                    // æ£€æŸ¥æ˜¯å¦åœ¨24å°æ—¶å†…
                    if (now - keyData.timestamp < twentyFourHours) {
                        document.getElementById('apiKey').value = keyData.apiKey;
                        config.apiKey = keyData.apiKey;
                    } else {
                        // è¶…è¿‡24å°æ—¶ï¼Œæ¸…é™¤ä¿å­˜çš„å¯†é’¥
                        localStorage.removeItem('taskmaster_api_key_data');
                        localStorage.removeItem('taskmaster_api_key'); // æ¸…é™¤æ—§æ ¼å¼
                    }
                } catch (e) {
                    // å¦‚æœè§£æå¤±è´¥ï¼Œæ£€æŸ¥æ˜¯å¦æœ‰æ—§æ ¼å¼çš„æ•°æ®
                    const oldApiKey = localStorage.getItem('taskmaster_api_key');
                    if (oldApiKey) {
                        // è¿ç§»æ—§æ•°æ®åˆ°æ–°æ ¼å¼
                        saveApiKeyWithTimestamp(oldApiKey);
                        document.getElementById('apiKey').value = oldApiKey;
                        config.apiKey = oldApiKey;
                        localStorage.removeItem('taskmaster_api_key'); // æ¸…é™¤æ—§æ ¼å¼
                    }
                }
            }
            
            if (savedBaseUrl) {
                document.getElementById('baseUrl').value = savedBaseUrl;
                config.baseUrl = savedBaseUrl;
            }
        }

        // ä¿å­˜APIå¯†é’¥ï¼ˆå¸¦æ—¶é—´æˆ³ï¼‰
        function saveApiKeyWithTimestamp(apiKey) {
            const keyData = {
                apiKey: apiKey,
                timestamp: Date.now()
            };
            localStorage.setItem('taskmaster_api_key_data', JSON.stringify(keyData));
        }

        // ä¿å­˜é…ç½®
        function saveConfig() {
            const apiKey = document.getElementById('apiKey').value;
            config.apiKey = apiKey;
            config.baseUrl = document.getElementById('baseUrl').value;
            
            // åªæœ‰åœ¨APIå¯†é’¥ä¸ä¸ºç©ºæ—¶æ‰ä¿å­˜
            if (apiKey.trim()) {
                saveApiKeyWithTimestamp(apiKey);
            }
            
            localStorage.setItem('taskmaster_base_url', config.baseUrl);
        }

        // APIè¯·æ±‚å‡½æ•°
        async function apiRequest(endpoint, options = {}) {
            saveConfig();
            
            const url = `${config.baseUrl}${endpoint}`;
            const defaultOptions = {
                headers: {
                    'Content-Type': 'application/json',
                    'X-API-Key': config.apiKey
                }
            };
            
            const requestOptions = { ...defaultOptions, ...options };
            if (options.headers) {
                requestOptions.headers = { ...defaultOptions.headers, ...options.headers };
            }
            
            try {
                showLoading(true);
                const response = await fetch(url, requestOptions);
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || `HTTP ${response.status}`);
                }
                
                return data;
            } catch (error) {
                console.error('APIè¯·æ±‚å¤±è´¥:', error);
                throw error;
            } finally {
                showLoading(false);
            }
        }

        // æ˜¾ç¤º/éšè—åŠ è½½æŒ‡ç¤ºå™¨
        function showLoading(show) {
            const indicator = document.getElementById('loadingIndicator');
            if (show) {
                indicator.classList.add('show');
            } else {
                indicator.classList.remove('show');
            }
        }

        // æ˜¾ç¤ºå“åº”
        function showResponse(data, title = 'å“åº”ç»“æœ') {
            const responseArea = document.getElementById('responseArea');
            responseArea.style.display = 'block';
            responseArea.innerHTML = `<h4>${title}</h4>\n${JSON.stringify(data, null, 2)}`;
            responseArea.scrollIntoView({ behavior: 'smooth' });
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showAlert(message, type = 'info') {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            
            const container = document.querySelector('.tab-pane.active');
            container.insertBefore(alertDiv, container.firstChild);
            
            setTimeout(() => {
                alertDiv.remove();
            }, 5000);
        }

        // æµ‹è¯•è¿æ¥
        async function testConnection() {
            try {
                // é¦–å…ˆéªŒè¯APIå¯†é’¥æ˜¯å¦ä¸ºç©º
                const apiKey = document.getElementById('apiKey').value.trim();
                if (!apiKey) {
                    throw new Error('APIå¯†é’¥ä¸èƒ½ä¸ºç©ºï¼Œè¯·å…ˆé…ç½®APIå¯†é’¥');
                }
                
                // ä½¿ç”¨å®é™…çš„APIç«¯ç‚¹æµ‹è¯•è¿æ¥å’ŒAPIå¯†é’¥
                const data = await apiRequest('/health');
                
                const statusIndicator = document.getElementById('statusIndicator');
                const systemStatus = document.getElementById('systemStatus');
                
                if (data.success) {
                    statusIndicator.textContent = data.taskMasterIntegrated ? 
                        'âœ… å·²è¿æ¥ (çœŸå®æ•°æ®)' : 'âš ï¸ å·²è¿æ¥ (æ¨¡æ‹Ÿæ•°æ®)';
                    statusIndicator.className = data.taskMasterIntegrated ? 
                        'status-indicator status-connected' : 'status-indicator status-mock';
                    
                    systemStatus.innerHTML = `
                        <div class="alert alert-success">
                            <strong>âœ… è¿æ¥æˆåŠŸ!</strong><br>
                            çŠ¶æ€: ${data.status}<br>
                            æ—¶é—´: ${new Date(data.timestamp).toLocaleString()}<br>
                            Task Masteré›†æˆ: ${data.taskMasterIntegrated ? 'çœŸå®æ ¸å¿ƒ' : 'æ¨¡æ‹Ÿæ•°æ®'}
                        </div>
                    `;
                    
                    showAlert('è¿æ¥æµ‹è¯•æˆåŠŸ!', 'success');
                } else {
                    throw new Error('å¥åº·æ£€æŸ¥å¤±è´¥');
                }
            } catch (error) {
                const statusIndicator = document.getElementById('statusIndicator');
                const systemStatus = document.getElementById('systemStatus');
                
                statusIndicator.textContent = 'âŒ è¿æ¥å¤±è´¥';
                statusIndicator.className = 'status-indicator alert-error';
                
                systemStatus.innerHTML = `
                    <div class="alert alert-error">
                        <strong>âŒ è¿æ¥å¤±è´¥!</strong><br>
                        é”™è¯¯: ${error.message}
                    </div>
                `;
                
                showAlert(`è¿æ¥å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // ä»»åŠ¡ç®¡ç†åŠŸèƒ½
        async function loadTasks() {
            try {
                const data = await apiRequest('/api/tasks');
                displayTasks(data.data.tasks);
                showAlert('ä»»åŠ¡åˆ—è¡¨åŠ è½½æˆåŠŸ!', 'success');
            } catch (error) {
                showAlert(`åŠ è½½ä»»åŠ¡å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function displayTasks(tasks) {
            const container = document.getElementById('tasksContainer');
            
            if (!tasks || tasks.length === 0) {
                container.innerHTML = '<p class="text-center">æš‚æ— ä»»åŠ¡</p>';
                return;
            }
            
            // æŒ‰çŠ¶æ€åˆ†ç»„ä»»åŠ¡
            const groupedTasks = {
                'pending': [],
                'in-progress': [],
                'done': [],
                'blocked': [],
                'cancelled': [],
                'deferred': [],
                'review': [],
                'other': []
            };
            
            tasks.forEach(task => {
                const status = task.status || 'other';
                if (groupedTasks[status]) {
                    groupedTasks[status].push(task);
                } else {
                    groupedTasks['other'].push(task);
                }
            });
            
            // çŠ¶æ€æ˜¾ç¤ºé¡ºåºå’Œé…ç½®
            const statusConfig = {
                'pending': { title: 'ğŸ“‹ å¾…å¤„ç†', color: '#ffc107', count: groupedTasks['pending'].length },
                'in-progress': { title: 'ğŸ”„ è¿›è¡Œä¸­', color: '#007bff', count: groupedTasks['in-progress'].length },
                'review': { title: 'ğŸ‘€ å¤æŸ¥ä¸­', color: '#fd7e14', count: groupedTasks['review'].length },
                'done': { title: 'âœ… å·²å®Œæˆ', color: '#28a745', count: groupedTasks['done'].length },
                'blocked': { title: 'ğŸš« é˜»å¡', color: '#dc3545', count: groupedTasks['blocked'].length },
                'deferred': { title: 'â¸ï¸ å»¶è¿Ÿ', color: '#6f42c1', count: groupedTasks['deferred'].length },
                'cancelled': { title: 'âŒ å·²å–æ¶ˆ', color: '#6c757d', count: groupedTasks['cancelled'].length },
                'other': { title: 'ğŸ“ å…¶ä»–', color: '#6c757d', count: groupedTasks['other'].length }
            };
            
            let html = '';
            
            // ç”Ÿæˆæ¯ä¸ªçŠ¶æ€åˆ†ç»„
            Object.keys(statusConfig).forEach(status => {
                const config = statusConfig[status];
                const statusTasks = groupedTasks[status];
                
                                 if (statusTasks.length > 0) {
                     html += `
                         <div class="status-group" style="margin-bottom: 30px;">
                             <div class="status-header" onclick="toggleStatusGroup('${status}')" style="
                                 background: ${config.color};
                                 color: white;
                                 padding: 12px 20px;
                                 border-radius: 8px 8px 0 0;
                                 font-weight: 600;
                                 display: flex;
                                 justify-content: space-between;
                                 align-items: center;
                                 cursor: pointer;
                                 user-select: none;
                                 transition: all 0.3s ease;
                             " onmouseover="this.style.opacity='0.9'" onmouseout="this.style.opacity='1'">
                                 <span>
                                     <span id="toggle-icon-${status}" class="toggle-icon">â–¼</span>
                                     ${config.title}
                                 </span>
                                 <span class="task-count">${config.count} ä¸ªä»»åŠ¡</span>
                             </div>
                             <div class="status-tasks" id="status-tasks-${status}" style="
                                 border: 2px solid ${config.color};
                                 border-top: none;
                                 border-radius: 0 0 8px 8px;
                                 padding: 15px;
                                 background: #f8f9fa;
                                 display: block;
                                 transition: all 0.3s ease;
                             ">
                     `;
                    
                    statusTasks.forEach(task => {
                        html += `
                            <div class="task-item" id="task-${task.id}" style="
                                background: white;
                                border: 1px solid #dee2e6;
                                border-radius: 8px;
                                padding: 15px;
                                margin-bottom: 15px;
                                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                            ">
                                <div class="task-header">
                                    <div>
                                        <span class="task-id">#${task.id}</span>
                                        <span class="task-status status-${task.status}">${getStatusText(task.status)}</span>
                                    </div>
                                    <div class="btn-group" style="gap: 5px;">
                                        <button class="btn btn-info" style="padding: 5px 10px; font-size: 0.8rem;" onclick="toggleTaskDetail('${task.id}')" id="detail-btn-${task.id}">è¯¦æƒ…</button>
                                        ${getActionButtons(task.status, task.id)}
                                    </div>
                                </div>
                                <div class="task-title">${task.title}</div>
                                <div class="task-description">${task.description}</div>
                                ${task.priority ? `<div style="margin-top: 10px;"><small>ä¼˜å…ˆçº§: ${getPriorityText(task.priority)}</small></div>` : ''}
                                <div class="task-detail" id="detail-${task.id}" style="display: none;">
                                    <div class="loading">åŠ è½½è¯¦æƒ…ä¸­...</div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                }
            });
            
            if (html === '') {
                container.innerHTML = '<p class="text-center">æš‚æ— ä»»åŠ¡</p>';
                // éšè—å…¨éƒ¨å±•å¼€/æŠ˜å æŒ‰é’®
                const toggleBtn = document.getElementById('toggleAllBtn');
                if (toggleBtn) {
                    toggleBtn.style.display = 'none';
                }
            } else {
                container.innerHTML = html;
                // æ˜¾ç¤ºå¹¶æ›´æ–°å…¨éƒ¨å±•å¼€/æŠ˜å æŒ‰é’®
                updateToggleAllButton();
            }
        }

        function getStatusText(status) {
            const statusMap = {
                'pending': 'å¾…å¤„ç†',
                'in-progress': 'è¿›è¡Œä¸­',
                'done': 'å·²å®Œæˆ',
                'blocked': 'é˜»å¡',
                'cancelled': 'å·²å–æ¶ˆ',
                'deferred': 'å»¶è¿Ÿ',
                'review': 'å¤æŸ¥ä¸­'
            };
            return statusMap[status] || status;
        }

        function getPriorityText(priority) {
            const priorityMap = {
                'high': 'é«˜',
                'medium': 'ä¸­',
                'low': 'ä½'
            };
            return priorityMap[priority] || priority;
        }

        function getActionButtons(status, taskId) {
            const buttons = [];
            
            switch (status) {
                case 'pending':
                    buttons.push(`<button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.8rem;" onclick="updateTaskStatus('${taskId}', 'in-progress')">å¼€å§‹</button>`);
                    buttons.push(`<button class="btn btn-success" style="padding: 5px 10px; font-size: 0.8rem;" onclick="updateTaskStatus('${taskId}', 'done')">å®Œæˆ</button>`);
                    break;
                case 'in-progress':
                    buttons.push(`<button class="btn btn-success" style="padding: 5px 10px; font-size: 0.8rem;" onclick="updateTaskStatus('${taskId}', 'done')">å®Œæˆ</button>`);
                    buttons.push(`<button class="btn btn-warning" style="padding: 5px 10px; font-size: 0.8rem;" onclick="updateTaskStatus('${taskId}', 'review')">å¤æŸ¥</button>`);
                    buttons.push(`<button class="btn btn-secondary" style="padding: 5px 10px; font-size: 0.8rem;" onclick="updateTaskStatus('${taskId}', 'pending')">æš‚åœ</button>`);
                    break;
                case 'review':
                    buttons.push(`<button class="btn btn-success" style="padding: 5px 10px; font-size: 0.8rem;" onclick="updateTaskStatus('${taskId}', 'done')">é€šè¿‡</button>`);
                    buttons.push(`<button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.8rem;" onclick="updateTaskStatus('${taskId}', 'in-progress')">ç»§ç»­</button>`);
                    break;
                case 'blocked':
                    buttons.push(`<button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.8rem;" onclick="updateTaskStatus('${taskId}', 'in-progress')">è§£é”</button>`);
                    break;
                case 'deferred':
                    buttons.push(`<button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.8rem;" onclick="updateTaskStatus('${taskId}', 'pending')">æ¢å¤</button>`);
                    break;
                case 'done':
                    buttons.push(`<button class="btn btn-secondary" style="padding: 5px 10px; font-size: 0.8rem;" onclick="updateTaskStatus('${taskId}', 'pending')">é‡å¼€</button>`);
                    break;
                case 'cancelled':
                    buttons.push(`<button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.8rem;" onclick="updateTaskStatus('${taskId}', 'pending')">æ¢å¤</button>`);
                    break;
                default:
                    buttons.push(`<button class="btn btn-primary" style="padding: 5px 10px; font-size: 0.8rem;" onclick="updateTaskStatus('${taskId}', 'in-progress')">å¼€å§‹</button>`);
                    break;
            }
            
            return buttons.join('');
        }

        function toggleStatusGroup(status) {
            const tasksContainer = document.getElementById(`status-tasks-${status}`);
            const toggleIcon = document.getElementById(`toggle-icon-${status}`);
            
            if (tasksContainer && toggleIcon) {
                const isCollapsed = tasksContainer.classList.contains('collapsed');
                
                if (isCollapsed) {
                    // å±•å¼€
                    tasksContainer.classList.remove('collapsed');
                    toggleIcon.classList.remove('collapsed');
                    toggleIcon.textContent = 'â–¼';
                } else {
                    // æŠ˜å 
                    tasksContainer.classList.add('collapsed');
                    toggleIcon.classList.add('collapsed');
                    toggleIcon.textContent = 'â–¶';
                }
                
                // æ›´æ–°å…¨éƒ¨å±•å¼€/æŠ˜å æŒ‰é’®çŠ¶æ€
                updateToggleAllButton();
            }
        }

        function toggleAllStatusGroups() {
            const statusGroups = document.querySelectorAll('.status-tasks');
            const toggleBtn = document.getElementById('toggleAllBtn');
            
            if (statusGroups.length === 0) return;
            
            // æ£€æŸ¥å½“å‰çŠ¶æ€ - å¦‚æœæœ‰ä»»ä½•ä¸€ä¸ªæ˜¯å±•å¼€çš„ï¼Œåˆ™å…¨éƒ¨æŠ˜å ï¼›å¦åˆ™å…¨éƒ¨å±•å¼€
            const hasExpanded = Array.from(statusGroups).some(group => !group.classList.contains('collapsed'));
            
            statusGroups.forEach(group => {
                const groupId = group.id;
                const status = groupId.replace('status-tasks-', '');
                const toggleIcon = document.getElementById(`toggle-icon-${status}`);
                
                if (hasExpanded) {
                    // å…¨éƒ¨æŠ˜å 
                    group.classList.add('collapsed');
                    if (toggleIcon) {
                        toggleIcon.classList.add('collapsed');
                        toggleIcon.textContent = 'â–¶';
                    }
                } else {
                    // å…¨éƒ¨å±•å¼€
                    group.classList.remove('collapsed');
                    if (toggleIcon) {
                        toggleIcon.classList.remove('collapsed');
                        toggleIcon.textContent = 'â–¼';
                    }
                }
            });
            
            // æ›´æ–°æŒ‰é’®æ–‡æœ¬
            updateToggleAllButton();
        }

        function updateToggleAllButton() {
            const statusGroups = document.querySelectorAll('.status-tasks');
            const toggleBtn = document.getElementById('toggleAllBtn');
            
            if (statusGroups.length === 0) {
                toggleBtn.style.display = 'none';
                return;
            }
            
            const hasExpanded = Array.from(statusGroups).some(group => !group.classList.contains('collapsed'));
            
            if (hasExpanded) {
                toggleBtn.textContent = 'ğŸ“‚ å…¨éƒ¨æŠ˜å ';
                toggleBtn.className = 'btn btn-warning';
            } else {
                toggleBtn.textContent = 'ğŸ“‚ å…¨éƒ¨å±•å¼€';
                toggleBtn.className = 'btn btn-secondary';
            }
            
            toggleBtn.style.display = 'inline-block';
        }

        async function getNextTask() {
            try {
                const response = await apiRequest('/api/tasks/next');
                // å®‰å…¨åœ°æ£€æŸ¥å“åº”æ•°æ®ç»“æ„
                if (response && response.data && response.data.nextTask) {
                    displayTasks([response.data.nextTask]);
                    showAlert('ä¸‹ä¸€ä¸ªä»»åŠ¡è·å–æˆåŠŸ!', 'success');
                } else {
                    showAlert('æš‚æ— å¯æ‰§è¡Œçš„ä¸‹ä¸€ä¸ªä»»åŠ¡', 'info');
                    // æ¸…ç©ºä»»åŠ¡å®¹å™¨
                    document.getElementById('tasksContainer').innerHTML = '<p class="text-center">æš‚æ— å¯æ‰§è¡Œçš„ä¸‹ä¸€ä¸ªä»»åŠ¡</p>';
                }
            } catch (error) {
                showAlert(`è·å–ä¸‹ä¸€ä¸ªä»»åŠ¡å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function toggleTaskDetail(taskId) {
            const detailDiv = document.getElementById(`detail-${taskId}`);
            const detailBtn = document.getElementById(`detail-btn-${taskId}`);
            
            if (detailDiv.style.display === 'none') {
                // å±•å¼€è¯¦æƒ…
                detailDiv.style.display = 'block';
                detailBtn.textContent = 'æ”¶èµ·';
                detailBtn.classList.remove('btn-info');
                detailBtn.classList.add('btn-secondary');
                
                // åŠ è½½è¯¦æƒ…æ•°æ®
                try {
                    detailDiv.innerHTML = '<div class="loading">åŠ è½½è¯¦æƒ…ä¸­...</div>';
                    const data = await apiRequest(`/api/tasks/${taskId}`);
                    
                    // æ ¼å¼åŒ–æ˜¾ç¤ºè¯¦æƒ…
                    const task = data.data.task || data.data;
                    let detailHtml = `<h4>ä»»åŠ¡ #${taskId} è¯¦æƒ…</h4>`;
                    detailHtml += `<strong>æ ‡é¢˜:</strong> ${task.title || 'æ— '}\n`;
                    detailHtml += `<strong>æè¿°:</strong> ${task.description || 'æ— '}\n`;
                    detailHtml += `<strong>çŠ¶æ€:</strong> ${getStatusText(task.status)}\n`;
                    if (task.priority) {
                        detailHtml += `<strong>ä¼˜å…ˆçº§:</strong> ${getPriorityText(task.priority)}\n`;
                    }
                    if (task.dependencies && task.dependencies.length > 0) {
                        detailHtml += `<strong>ä¾èµ–:</strong> ${task.dependencies.join(', ')}\n`;
                    }
                    if (task.details) {
                        detailHtml += `<strong>å®ç°ç»†èŠ‚:</strong>\n${task.details}\n`;
                    }
                    if (task.testStrategy) {
                        detailHtml += `<strong>æµ‹è¯•ç­–ç•¥:</strong>\n${task.testStrategy}\n`;
                    }
                    if (task.subtasks && task.subtasks.length > 0) {
                        detailHtml += `<strong>å­ä»»åŠ¡:</strong>\n`;
                        task.subtasks.forEach((subtask, index) => {
                            detailHtml += `${index + 1}. [${getStatusText(subtask.status)}] ${subtask.title}\n`;
                            if (subtask.description) {
                                detailHtml += `   ${subtask.description}\n`;
                            }
                        });
                    }
                    
                    detailDiv.innerHTML = detailHtml;
                } catch (error) {
                    detailDiv.innerHTML = `<div style="color: #dc3545;">åŠ è½½è¯¦æƒ…å¤±è´¥: ${error.message}</div>`;
                }
            } else {
                // æ”¶èµ·è¯¦æƒ…
                detailDiv.style.display = 'none';
                detailBtn.textContent = 'è¯¦æƒ…';
                detailBtn.classList.remove('btn-secondary');
                detailBtn.classList.add('btn-info');
            }
        }

        async function updateTaskStatus(taskId, status) {
            try {
                const data = await apiRequest(`/api/tasks/${taskId}/status`, {
                    method: 'PUT',
                    body: JSON.stringify({ status })
                });
                showAlert(`ä»»åŠ¡çŠ¶æ€æ›´æ–°æˆåŠŸ!`, 'success');
                loadTasks(); // é‡æ–°åŠ è½½ä»»åŠ¡åˆ—è¡¨
            } catch (error) {
                showAlert(`æ›´æ–°ä»»åŠ¡çŠ¶æ€å¤±è´¥: ${error.message}`, 'error');
            }
        }

        function showCreateTaskForm() {
            document.getElementById('createTaskForm').style.display = 'block';
        }

        function hideCreateTaskForm() {
            document.getElementById('createTaskForm').style.display = 'none';
            // æ¸…ç©ºè¡¨å•
            document.getElementById('taskPrompt').value = '';
            document.getElementById('taskPriority').value = 'medium';
            document.getElementById('taskDependencies').value = '';
        }

        async function createTask() {
            const prompt = document.getElementById('taskPrompt').value.trim();
            if (!prompt) {
                showAlert('è¯·è¾“å…¥ä»»åŠ¡æè¿°', 'error');
                return;
            }

            try {
                const taskData = {
                    prompt: prompt,
                    priority: document.getElementById('taskPriority').value,
                    dependencies: document.getElementById('taskDependencies').value.trim()
                };

                const data = await apiRequest('/api/tasks', {
                    method: 'POST',
                    body: JSON.stringify(taskData)
                });

                showAlert('ä»»åŠ¡åˆ›å»ºæˆåŠŸ!', 'success');
                hideCreateTaskForm();
                loadTasks(); // é‡æ–°åŠ è½½ä»»åŠ¡åˆ—è¡¨
                showResponse(data.data, 'æ–°åˆ›å»ºçš„ä»»åŠ¡');
            } catch (error) {
                showAlert(`åˆ›å»ºä»»åŠ¡å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // é¡¹ç›®ç®¡ç†åŠŸèƒ½
        async function initializeProject() {
            const projectName = document.getElementById('projectName').value.trim();
            if (!projectName) {
                showAlert('è¯·è¾“å…¥é¡¹ç›®åç§°', 'error');
                return;
            }

            try {
                const projectData = {
                    projectName: projectName,
                    projectDescription: document.getElementById('projectDescription').value.trim(),
                    projectVersion: document.getElementById('projectVersion').value.trim() || '1.0.0',
                    yes: true
                };

                const data = await apiRequest('/api/projects/initialize', {
                    method: 'POST',
                    body: JSON.stringify(projectData)
                });

                showAlert('é¡¹ç›®åˆå§‹åŒ–æˆåŠŸ!', 'success');
                showResponse(data.data, 'é¡¹ç›®åˆå§‹åŒ–ç»“æœ');
            } catch (error) {
                showAlert(`é¡¹ç›®åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
            }
        }

        async function parsePrd() {
            const prdContent = document.getElementById('prdContent').value.trim();
            if (!prdContent) {
                showAlert('è¯·è¾“å…¥PRDå†…å®¹', 'error');
                return;
            }

            try {
                const prdData = {
                    input: prdContent,
                    numTasks: parseInt(document.getElementById('numTasks').value) || 5
                };

                const data = await apiRequest('/api/projects/parse-prd', {
                    method: 'POST',
                    body: JSON.stringify(prdData)
                });

                showAlert('PRDè§£ææˆåŠŸ!', 'success');
                showResponse(data.data, 'PRDè§£æç»“æœ');
            } catch (error) {
                showAlert(`PRDè§£æå¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½
        function setupFileUpload() {
            const uploadArea = document.getElementById('fileUploadArea');
            
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFileSelect({ target: { files } });
                }
            });
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;

            if (file.size > 10 * 1024 * 1024) {
                showAlert('æ–‡ä»¶å¤§å°ä¸èƒ½è¶…è¿‡10MB', 'error');
                return;
            }

            if (!file.type.startsWith('text/') && !file.name.endsWith('.txt') && !file.name.endsWith('.md')) {
                showAlert('è¯·é€‰æ‹©æ–‡æœ¬æ–‡ä»¶ (.txt, .md)', 'error');
                return;
            }

            selectedFile = file;
            document.getElementById('uploadBtn').disabled = false;
            
            const uploadArea = document.getElementById('fileUploadArea');
            uploadArea.innerHTML = `
                <div>
                    <h4>ğŸ“„ å·²é€‰æ‹©æ–‡ä»¶</h4>
                    <p>${file.name} (${(file.size / 1024).toFixed(1)} KB)</p>
                </div>
            `;
            
            showAlert(`æ–‡ä»¶ "${file.name}" å·²é€‰æ‹©`, 'success');
        }

        async function uploadPrdFile() {
            if (!selectedFile) {
                showAlert('è¯·å…ˆé€‰æ‹©æ–‡ä»¶', 'error');
                return;
            }

            try {
                const formData = new FormData();
                formData.append('file', selectedFile);
                formData.append('numTasks', document.getElementById('numTasks').value || '5');

                const data = await apiRequest('/api/projects/parse-prd-file', {
                    method: 'POST',
                    headers: {
                        'X-API-Key': config.apiKey
                        // ä¸è®¾ç½® Content-Typeï¼Œè®©æµè§ˆå™¨è‡ªåŠ¨è®¾ç½®
                    },
                    body: formData
                });

                showAlert('PRDæ–‡ä»¶è§£ææˆåŠŸ!', 'success');
                showResponse(data.data, 'PRDæ–‡ä»¶è§£æç»“æœ');
            } catch (error) {
                showAlert(`PRDæ–‡ä»¶è§£æå¤±è´¥: ${error.message}`, 'error');
            }
        }

        // AIç ”ç©¶åŠŸèƒ½
        async function performResearch() {
            const query = document.getElementById('researchQuery').value.trim();
            if (!query) {
                showAlert('è¯·è¾“å…¥ç ”ç©¶é—®é¢˜', 'error');
                return;
            }

            try {
                const researchData = {
                    query: query,
                    detailLevel: document.getElementById('detailLevel').value,
                    customContext: document.getElementById('customContext').value.trim()
                };

                const data = await apiRequest('/api/research', {
                    method: 'POST',
                    body: JSON.stringify(researchData)
                });

                // å®‰å…¨åœ°è®¿é—®å“åº”æ•°æ®
                const responseData = data && data.data ? data.data : {};
                const result = responseData.result || responseData.response || responseData.content || '';
                
                const resultsContainer = document.getElementById('researchResults');
                
                if (result) {
                    resultsContainer.innerHTML = `
                        <div class="config-section">
                            <h4>ğŸ” ç ”ç©¶é—®é¢˜</h4>
                            <p>${query}</p>
                            
                            <h4>ğŸ“ ç ”ç©¶ç»“æœ</h4>
                            <div class="response-area" style="
                                white-space: pre-wrap; 
                                background: #f8f9fa; 
                                padding: 15px; 
                                border-radius: 8px; 
                                border-left: 4px solid #007bff;
                            ">${result}</div>
                            
                            ${responseData.sources ? `
                                <h4>ğŸ“š æ•°æ®æº</h4>
                                <ul>
                                    ${responseData.sources.map(source => `<li>${source}</li>`).join('')}
                                </ul>
                            ` : ''}
                            
                            <p><small>ç”Ÿæˆæ—¶é—´: ${responseData.timestamp ? new Date(responseData.timestamp).toLocaleString() : new Date().toLocaleString()}</small></p>
                        </div>
                    `;
                    showAlert('AIç ”ç©¶å®Œæˆ!', 'success');
                } else {
                    // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                    resultsContainer.innerHTML = `
                        <div class="config-section">
                            <h4>ğŸ” ç ”ç©¶é—®é¢˜</h4>
                            <p>${query}</p>
                            
                            <div class="alert alert-warning">
                                <h4>âš ï¸ ç ”ç©¶æœåŠ¡æš‚æ—¶ä¸å¯ç”¨</h4>
                                <p>å½“å‰é…ç½®çš„AIæ¨¡å‹ (Qianwen) åœ¨æ‚¨çš„åœ°åŒºå¯èƒ½ä¸å—æ”¯æŒã€‚</p>
                                <p><strong>å»ºè®®è§£å†³æ–¹æ¡ˆï¼š</strong></p>
                                <ul>
                                    <li>è”ç³»ç®¡ç†å‘˜é…ç½®å…¶ä»–AIæ¨¡å‹ï¼ˆå¦‚OpenAIã€Anthropicç­‰ï¼‰</li>
                                    <li>æ£€æŸ¥APIå¯†é’¥å’Œç½‘ç»œè¿æ¥</li>
                                    <li>æˆ–æš‚æ—¶ä½¿ç”¨å…¶ä»–åŠŸèƒ½</li>
                                </ul>
                                <p><small>é”™è¯¯è¯¦æƒ…: ${data && data.error ? data.error : 'æœåŠ¡ä¸å¯ç”¨'}</small></p>
                            </div>
                        </div>
                    `;
                    showAlert('AIç ”ç©¶æœåŠ¡å½“å‰ä¸å¯ç”¨', 'warning');
                }
            } catch (error) {
                console.error('Research API Error:', error);
                
                // æ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯
                const resultsContainer = document.getElementById('researchResults');
                resultsContainer.innerHTML = `
                    <div class="config-section">
                        <h4>ğŸ” ç ”ç©¶é—®é¢˜</h4>
                        <p>${query}</p>
                        
                        <div class="alert alert-danger">
                            <h4>âŒ ç ”ç©¶è¯·æ±‚å¤±è´¥</h4>
                            <p><strong>é”™è¯¯ä¿¡æ¯:</strong> ${error.message}</p>
                            
                            <h5>ğŸ”§ å¯èƒ½çš„è§£å†³æ–¹æ¡ˆï¼š</h5>
                            <ul>
                                <li><strong>APIé…ç½®é—®é¢˜:</strong> æ£€æŸ¥æœåŠ¡å™¨æ˜¯å¦æ­£å¸¸è¿è¡Œ</li>
                                <li><strong>æ¨¡å‹é…ç½®é—®é¢˜:</strong> å½“å‰ä½¿ç”¨çš„æ˜¯Qianwenæ¨¡å‹ï¼Œå¯èƒ½åœ¨æ‚¨çš„åœ°åŒºä¸å—æ”¯æŒ</li>
                                <li><strong>ç½‘ç»œé—®é¢˜:</strong> æ£€æŸ¥ç½‘ç»œè¿æ¥å’Œé˜²ç«å¢™è®¾ç½®</li>
                                <li><strong>APIå¯†é’¥é—®é¢˜:</strong> æ£€æŸ¥AIæœåŠ¡çš„APIå¯†é’¥é…ç½®</li>
                            </ul>
                            
                            <h5>ğŸ“‹ å»ºè®®çš„æ›¿ä»£æ–¹æ¡ˆï¼š</h5>
                            <ul>
                                <li>é…ç½®OpenAI APIå¯†é’¥ (GPT-4, GPT-3.5ç­‰)</li>
                                <li>é…ç½®Anthropic APIå¯†é’¥ (Claudeç³»åˆ—)</li>
                                <li>ä½¿ç”¨æœ¬åœ°è¿è¡Œçš„Ollamaæ¨¡å‹</li>
                                <li>è”ç³»ç³»ç»Ÿç®¡ç†å‘˜æ£€æŸ¥æœåŠ¡å™¨é…ç½®</li>
                            </ul>
                            
                            <p><small>é”™è¯¯æ—¶é—´: ${new Date().toLocaleString()}</small></p>
                        </div>
                    </div>
                `;
                
                showAlert(`AIç ”ç©¶å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // APIæ–‡æ¡£åŠŸèƒ½
        async function loadApiDocs() {
            try {
                const data = await apiRequest('/debug/routes');
                
                const container = document.getElementById('apiDocsContainer');
                container.innerHTML = `
                    <div class="config-section">
                        <h4>ğŸ“‹ å¯ç”¨APIç«¯ç‚¹</h4>
                        <ul>
                            ${data.availableRoutes.map(route => `<li><code>${route}</code></li>`).join('')}
                        </ul>
                        
                        <h4>ğŸ§ª æµ‹è¯•å‘½ä»¤</h4>
                        <div class="response-area">${JSON.stringify(data.testCommands, null, 2)}</div>
                        
                        <h4>ğŸ”§ é›†æˆçŠ¶æ€</h4>
                        <div class="alert alert-info">
                            <strong>çŠ¶æ€:</strong> ${data.taskMasterIntegration.status}<br>
                            <strong>æè¿°:</strong> ${data.taskMasterIntegration.description}
                        </div>
                    </div>
                `;
                
                showAlert('APIæ–‡æ¡£åŠ è½½æˆåŠŸ!', 'success');
            } catch (error) {
                showAlert(`åŠ è½½APIæ–‡æ¡£å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // æ–°å¢é…ç½®åŠŸèƒ½

        // åŠ è½½AIé…ç½®ä¿¡æ¯
        async function loadAiConfig() {
            try {
                // æ¨¡æ‹ŸAIé…ç½®æ•°æ®ï¼ˆå®é™…å¯ä»¥é€šè¿‡APIè·å–ï¼‰
                const aiConfig = {
                    main: {
                        model: 'qwen-turbo-latest',
                        baseUrl: 'https://dashscope.aliyuncs.com/compatible-mode/v1'
                    },
                    research: {
                        model: 'qwen-turbo-latest', 
                        baseUrl: 'https://dashscope.aliyuncs.com/compatible-mode/v1'
                    },
                    fallback: {
                        model: 'qwen-turbo-latest',
                        baseUrl: 'https://dashscope.aliyuncs.com/compatible-mode/v1'
                    }
                };

                // æ›´æ–°æ˜¾ç¤º
                document.getElementById('currentMainModel').textContent = aiConfig.main.model;
                document.getElementById('currentMainBaseUrl').textContent = aiConfig.main.baseUrl;
                document.getElementById('currentResearchModel').textContent = aiConfig.research.model;
                document.getElementById('currentResearchBaseUrl').textContent = aiConfig.research.baseUrl;
                document.getElementById('currentFallbackModel').textContent = aiConfig.fallback.model;
                document.getElementById('currentFallbackBaseUrl').textContent = aiConfig.fallback.baseUrl;
                
                showAlert('AIé…ç½®ä¿¡æ¯å·²åˆ·æ–°!', 'success');
                
                // å¯ä»¥æ·»åŠ APIè°ƒç”¨æ¥è·å–çœŸå®é…ç½®
                // const data = await apiRequest('/api/config/ai');
                
            } catch (error) {
                showAlert(`åŠ è½½AIé…ç½®å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // åŠ è½½é¡¹ç›®ä¿¡æ¯
        async function loadProjectInfo() {
            try {
                // æ¨¡æ‹Ÿé¡¹ç›®ä¿¡æ¯ï¼Œå®é™…å¯ä»¥é€šè¿‡APIè·å–
                const projectInfo = {
                    name: "Task Master Web API",
                    version: "1.0.0",
                    status: "è¿è¡Œä¸­",
                    tasksCount: 15,
                    completedTasks: 8,
                    currentTag: "master"
                };

                const container = document.getElementById('projectInfo');
                container.innerHTML = `
                    <div class="alert alert-info">
                        <strong>ğŸ“‹ é¡¹ç›®åç§°:</strong> ${projectInfo.name}<br>
                        <strong>ğŸ”– ç‰ˆæœ¬:</strong> ${projectInfo.version}<br>
                        <strong>âš¡ çŠ¶æ€:</strong> ${projectInfo.status}<br>
                        <strong>ğŸ“Š ä»»åŠ¡ç»Ÿè®¡:</strong> ${projectInfo.completedTasks}/${projectInfo.tasksCount} å·²å®Œæˆ<br>
                        <strong>ğŸ·ï¸ å½“å‰æ ‡ç­¾:</strong> ${projectInfo.currentTag}
                    </div>
                `;
                
                showAlert('é¡¹ç›®ä¿¡æ¯åŠ è½½æˆåŠŸ!', 'success');
            } catch (error) {
                showAlert(`åŠ è½½é¡¹ç›®ä¿¡æ¯å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // åŠ è½½æ ‡ç­¾ä¿¡æ¯
        async function loadTagsInfo() {
            try {
                const data = await apiRequest('/api/tags');
                
                const container = document.getElementById('tagsInfo');
                if (data.data && data.data.tags) {
                    const tagsHtml = data.data.tags.map(tag => `
                        <div style="margin-bottom: 10px; padding: 10px; background: #f8f9fa; border-radius: 5px;">
                            <strong>${tag.name}</strong> 
                            ${tag.current ? '<span style="color: #28a745;">(å½“å‰)</span>' : ''}
                            <br>
                            <small>ä»»åŠ¡æ•°: ${tag.taskCount || 0} | 
                            å®Œæˆ: ${tag.completedTasks || 0} | 
                            åˆ›å»ºæ—¶é—´: ${tag.createdAt ? new Date(tag.createdAt).toLocaleDateString() : 'æœªçŸ¥'}</small>
                            ${tag.description ? `<br><small style="color: #6c757d;">${tag.description}</small>` : ''}
                        </div>
                    `).join('');
                    
                    container.innerHTML = tagsHtml;
                } else {
                    container.innerHTML = '<p>æš‚æ— æ ‡ç­¾ä¿¡æ¯</p>';
                }
                
                showAlert('æ ‡ç­¾ä¿¡æ¯åŠ è½½æˆåŠŸ!', 'success');
            } catch (error) {
                showAlert(`åŠ è½½æ ‡ç­¾ä¿¡æ¯å¤±è´¥: ${error.message}`, 'error');
            }
        }

        // åŠ è½½APIç»Ÿè®¡ä¿¡æ¯
        async function loadApiStats() {
            try {
                // æ¨¡æ‹ŸAPIç»Ÿè®¡æ•°æ®
                const stats = {
                    totalRequests: 1247,
                    successfulRequests: 1198,
                    failedRequests: 49,
                    averageResponseTime: "245ms",
                    uptime: "99.8%",
                    lastRequestTime: new Date().toISOString()
                };

                const container = document.getElementById('apiStats');
                container.innerHTML = `
                    <div class="alert alert-info">
                        <strong>ğŸ“ˆ æ€»è¯·æ±‚æ•°:</strong> ${stats.totalRequests}<br>
                        <strong>âœ… æˆåŠŸè¯·æ±‚:</strong> ${stats.successfulRequests}<br>
                        <strong>âŒ å¤±è´¥è¯·æ±‚:</strong> ${stats.failedRequests}<br>
                        <strong>â±ï¸ å¹³å‡å“åº”æ—¶é—´:</strong> ${stats.averageResponseTime}<br>
                        <strong>ğŸ”„ è¿è¡Œæ—¶é—´:</strong> ${stats.uptime}<br>
                        <strong>ğŸ• æœ€åè¯·æ±‚:</strong> ${new Date(stats.lastRequestTime).toLocaleString()}
                    </div>
                `;
                
                showAlert('APIç»Ÿè®¡ä¿¡æ¯åŠ è½½æˆåŠŸ!', 'success');
            } catch (error) {
                showAlert(`åŠ è½½APIç»Ÿè®¡å¤±è´¥: ${error.message}`, 'error');
            }
        }


    </script>
</body>
</html> 